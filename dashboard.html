<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <main class="main-content center-box">
    <div class="dashboard-box">
      <h2 class="welcome-text">Hello, [User's Name]</h2>

      <h3 class="section-heading">Signed Up Users:</h3>
        <table id="userTable" border="1" style="width: 100%; margin-bottom: 20px;">
        <thead>
            <tr>
            <th style="padding: 8px;">Name</th>
            <th style="padding: 8px;">Email</th>
            <th style="padding: 8px;">Actions</th>
            </tr>
        </thead>
        <tbody id="user-list"></tbody>
        </table>

       <button class="pretty-btn" title="Click to log out" id="logoutBtn">Logout</button>
    </div>
  </main>

<script>
  // Redirect to login if not logged in
  let currentUser = localStorage.getItem('currentUser');
  if (!currentUser) {
    window.location.href = 'index.html';
  }

  // Show welcome text
  document.querySelector('.welcome-text').textContent = `Hello, ${currentUser}`;

  const users = JSON.parse(localStorage.getItem('users')) || [];
  const userList = document.getElementById('user-list'); //<tbody id="user-list"></tbody>

  users.forEach((user, index) => {
    const row = document.createElement('tr');

    const nameCell = document.createElement('td');
    nameCell.textContent = user.name;
    nameCell.style.padding = '8px';

    const emailCell = document.createElement('td');
    emailCell.textContent = user.email;
    emailCell.style.padding = '8px';

    const actionCell = document.createElement('td');
    actionCell.style.padding = '8px';

    // Delete button
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'Delete';
    deleteBtn.classList.add('pretty-btn');
    deleteBtn.style.marginRight = '8px';
    deleteBtn.style.padding = '5px 10px';
    deleteBtn.style.cursor = 'pointer';

    deleteBtn.addEventListener('click', () => {
      const confirmed = confirm(`Are you sure you want to delete ${user.name}?`);
      if (!confirmed) return;

      const updatedUsers = users.filter(u => u.name !== user.name);
      localStorage.setItem('users', JSON.stringify(updatedUsers));

      if (currentUser === user.name) {
        alert('You deleted your own account. Logging out.');
        localStorage.removeItem('currentUser');
        window.location.href = 'login.html';
      } else {
        // If all users are deleted, redirect too
        if (updatedUsers.length === 0) {
          localStorage.removeItem('currentUser');
          window.location.href = 'login.html';
        } else {
          window.location.reload();
        }
      }
    });

    // Edit button
    const editBtn = document.createElement('button');
    editBtn.textContent = 'Edit';
    editBtn.classList.add('pretty-btn');
    editBtn.style.padding = '5px 10px';
    editBtn.style.cursor = 'pointer';

    editBtn.addEventListener('click', () => {
      const oldName = user.name;
      const newName = prompt(`Enter new name for ${user.name}:`, user.name);
      if (newName && newName.trim() !== "") {
        users[index].name = newName.trim();
        localStorage.setItem('users', JSON.stringify(users));

        // If editing yourself, update currentUser
        if (currentUser === oldName) {
          localStorage.setItem('currentUser', newName.trim());
          currentUser = newName.trim();
        }

        window.location.reload();
      }
    });

    // Add buttons and row to table
    actionCell.appendChild(deleteBtn);
    actionCell.appendChild(editBtn);

    row.appendChild(nameCell);
    row.appendChild(emailCell);
    row.appendChild(actionCell);

    userList.appendChild(row);
  });

  // Logout logic
  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('currentUser');
    window.location.href = 'index.html';
  });
</script>


</body>
</html>
